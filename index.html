<!-- index.html 全体を、没入感向上版にアップデートします -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ocean Tendency | Deep Sea Numerology</title>
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" type="image/png" href="icon-192.png"><meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ocean Tendency">
<meta name="theme-color" content="#000814">

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+JP:wght@100;300;500&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root {
  --neon-cyan: #00f2ff;
  --neon-blue: #0062ff;
  --deep-blue: #000814;
  --glass-bg: rgba(0, 20, 40, 0.85);
  --border-cyan: rgba(0, 242, 255, 0.4);
}

/* --- 全体レイアウト --- */
body, html {
  margin: 0; padding: 0; 
  min-height: 100%;
  font-family: 'Noto Sans JP', sans-serif;
  background-color: var(--deep-blue);
  color: #e0faff;
  overflow-x: hidden; 
}

body { overflow-y: hidden; transition: filter 0.3s; }
body.in-result { overflow-y: auto; }
body.glitch { filter: hue-rotate(90deg) brightness(1.5); }

/* イントロオーバーレイ */
#intro-overlay {
  position: fixed; inset: 0; background: var(--deep-blue);
  z-index: 2000; display: flex; align-items: center; justify-content: center;
  padding: 30px; transition: opacity 1s ease-in-out;
}
#intro-text-container {
  max-width: 600px; width: 100%;
  font-family: 'Share Tech Mono', 'Noto Sans JP', monospace;
  color: var(--neon-cyan); font-size: 0.9rem; line-height: 2;
  text-shadow: 0 0 5px var(--neon-cyan);
}

/* 背景制御 */
#ocean-bg {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  z-index: -2;
  background: radial-gradient(circle at center, #001a33 0%, #000814 100%);
}
/* 海中の塵（マリンスノー）演出 */
.marine-snow {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-image: radial-gradient(circle, #fff 1px, transparent 1px);
  background-size: 100px 100px;
  opacity: 0.1; pointer-events: none; z-index: -1;
  animation: snow 20s linear infinite;
}
@keyframes snow {
  from { background-position: 0 0; }
  to { background-position: 100px 1000px; }
}

.scanline {
  position: fixed; top: 0; left: 0; width: 100%; height: 2px;
  background: rgba(0, 242, 255, 0.1);
  box-shadow: 0 0 10px var(--neon-cyan);
  z-index: 1000; pointer-events: none;
  animation: scan 4s linear infinite;
}
@keyframes scan { 0% { top: -5%; } 100% { top: 105%; } }

/* ヘッダー */
.site-header {
  position: fixed; top: 0; width: 100%; padding: 15px 25px;
  display: flex; justify-content: space-between; align-items: center;
  box-sizing: border-box; z-index: 100;
  border-bottom: 1px solid var(--border-cyan);
  background: rgba(0, 15, 30, 0.8);
  backdrop-filter: blur(10px);
}

.depth-meter {
  font-family: 'Orbitron'; font-size: 0.8rem; color: var(--neon-cyan);
}

/* メインパネル */
.main-frame {
  position: relative; min-height: 100vh;
  display: flex; align-items: center; justify-content: center;
  box-sizing: border-box; padding: 100px 20px 60px 20px;
}

.ui-panel {
  background: var(--glass-bg);
  border: 1px solid var(--border-cyan);
  padding: 40px; backdrop-filter: blur(20px);
  position: relative; max-width: 1000px; width: 100%;
  box-shadow: 0 0 50px rgba(0, 242, 255, 0.1);
}

/* 生物画像サイズ： 1.3倍に調整 (350px -> 455px) */
.organism-container {
  position: relative; display: flex; justify-content: center; align-items: center;
  background: radial-gradient(circle, rgba(0, 242, 255, 0.15) 0%, transparent 75%);
  min-height: 400px;
}
.floating-organism {
  width: 100%; max-width: 455px; /* 1.3x */
  height: auto; filter: drop-shadow(0 0 30px var(--neon-cyan));
  z-index: 5; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.anim-float { animation: float 8s ease-in-out infinite; }
@keyframes float { 
  0%, 100% { transform: translateY(0) rotate(2deg) scale(1); } 
  50% { transform: translateY(-30px) rotate(-1deg) scale(1.02); } 
}

/* 結果のテキスト部分 */
.result-layout { display: grid; grid-template-columns: 1.2fr 1fr; gap: 40px; align-items: start; }

.sensor-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
  margin-top: 15px; font-family: 'Share Tech Mono'; font-size: 0.7rem;
  color: var(--border-cyan);
}
.sensor-item { border-left: 1px solid var(--border-cyan); padding-left: 8px; }

/* ボタン演出 */
.cyber-btn {
  font-family: 'Orbitron', sans-serif;
  padding: 15px 40px; background: transparent;
  color: var(--neon-cyan); border: 1px solid var(--neon-cyan);
  cursor: pointer; position: relative; transition: 0.3s;
  letter-spacing: 2px;
  clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
}
.cyber-btn:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 25px var(--neon-cyan); transform: scale(1.05); }
.cyber-btn:active { transform: scale(0.95); }

/* モバイル対応 */
@media (max-width: 850px) {
  .result-layout { grid-template-columns: 1fr; gap: 20px; }
  .floating-organism { max-width: 280px; } /* 220px -> 280px (1.3x) */
  .organism-container { min-height: 300px; }
  .ui-panel { padding: 30px 20px; width: 95%; }
}
</style>
</head>
<body onload="initSystem()">

<audio id="bgm" src="music.mp3" loop></audio>

<div id="intro-overlay">
  <div id="intro-text-container"><span id="typed-content"></span><span class="typing-cursor">_</span></div>
</div>

<div id="ocean-bg"></div>
<div class="marine-snow"></div>
<div class="scanline"></div>

<header class="site-header">
  <div class="site-title" style="letter-spacing: 0.2rem;">OCEAN TENDENCY</div>
  <div class="depth-meter">DEPTH: <span id="depthVal">0</span>m</div>
</header>

<main class="main-frame">
  <div class="ui-panel" id="inputPanel">
    <div style="text-align:center;">
      <h2 style="font-family:'Orbitron'; font-weight:300; letter-spacing:0.5rem; font-size:0.8rem; margin-bottom:40px; opacity: 0.7;">CONNECTED_TO_TRENCH_STATION</h2>
      <input type="date" id="birthdate" style="background:rgba(0,242,255,0.05); border:1px solid var(--border-cyan); color:var(--neon-cyan); padding:12px 20px; font-family:'Orbitron'; font-size:1.2rem; outline:none; width:100%; max-width:280px;">
      <div style="margin-top:40px;">
        <button class="cyber-btn" id="resultBtn">INITIATE SCAN</button>
      </div>
    </div>
  </div>

  <div class="ui-panel" id="resultContainer" style="display:none;">
    <div id="loadingOverlay" style="display:none; position:absolute; inset:0; background:var(--deep-blue); z-index:10; flex-direction:column; align-items:center; justify-content:center;">
        <div id="load-status" style="font-family:'Orbitron'; color:var(--neon-cyan); margin-bottom:20px; letter-spacing:5px;">DESCENDING...</div>
        <div style="width:250px; height:2px; background:rgba(0,242,255,0.1); position:relative; overflow:hidden;">
            <div id="progressBar" style="position:absolute; top:0; left:-100%; width:100%; height:100%; background:var(--neon-cyan); box-shadow:0 0 10px var(--neon-cyan);"></div>
        </div>
        <div id="analysis-log" style="font-family:'Share Tech Mono'; font-size:0.7rem; color:var(--border-cyan); margin-top:20px; height:1.2rem;"></div>
    </div>
    
    <div id="resultContent"></div>
    
    <div style="text-align:right; margin-top:25px; display: flex; justify-content: flex-end; gap: 10px;">
      <button class="cyber-btn" style="padding: 10px 20px; font-size:0.65rem;" id="musicBtn">AUDIO: OFF</button>
      <button class="cyber-btn" style="padding: 10px 20px; font-size:0.65rem;" id="backBtn">SURFACE</button>
    </div>
  </div>
</main>

<script>
const numerologyData = {
    "01": { title: "開拓突進型", organism: "CYBER-SHARK (High-Speed)", abilities: ["突破口の形成", "初動エネルギーの最大化", "未踏領域の開拓"], cautions: ["長期維持のリソース管理", "後方調整の軽視"], message: "速い流れは、迷わず前へ進む。進んだあとで、海は形を整えていく。" },
    "02": { title: "共鳴調整型", organism: "DOLPHIN (Sonar-Sync)", abilities: ["周波数同調", "複数個体の仲介", "環境調和"], cautions: ["個体境界の喪失", "意思決定の外部依存"], message: "波が重なる場所では、静かな響きが生まれる。感じた流れは、海の一部だ。" },
    "03": { title: "発光表現型", organism: "TROPICAL-UNIT (Light-Emitting)", abilities: ["視覚的情報拡散", "エンターテインメント", "心理的活性化"], cautions: ["注意散漫による出力低下", "評価への過剰反応"], message: "光は、隠れようとしない。泳ぐほどに、色は広がっていく。" },
    "04": { title: "構造安定型", organism: "TURTLE (Heavy-Armor)", abilities: ["基盤構造の構築", "長期的データの保存", "物理的防護"], cautions: ["プロトコルの固定化", "機動力の欠如"], message: "深い場所では、速さは必要ない。重ねた時間が、海を支えている。" },
    "05": { title: "流動探査型", organism: "OCTOPUS (Shifting-Logic)", abilities: ["多角的環境適応", "非定型ルートの探索", "情報収集"], cautions: ["核となる目的の忘却", "定着への拒絶感"], message: "形は、ひとつに決まらない。流れに合わせて、海も姿を変えている。" },
    "06": { title: "保護循環型", organism: "WHALE (Infrasound-Core)", abilities: ["広域エコシステムの維持", "育成支援", "情緒的エネルギー供給"], cautions: ["過剰なエネルギー背負い込み", "自己修復プロトコルの後回し"], message: "遠くまで届くものほど、静かに広がる。見えない場所でも、流れは続いている。" },
    "07": { title: "深層観測型", organism: "ABYSS-FISH (Extreme-Scanner)", abilities: ["深層心理の解析", "本質の抽出", "孤立環境での稼働"], cautions: ["論理の迷宮入り", "外部通信の遮断"], message: "光のない場所にも、海は広がっている。静けさの中で、多くのものが見えてくる。" },
    "08": { title: "支配構築型", organism: "ORCA (Strategic-Command)", abilities: ["戦略的統率", "大規模実行", "現実世界への実装"], cautions: ["高圧的な命令出力", "感情データのノイズ処理"], message: "大きな流れは、静かに動く。力は、波とともに形を変える。" },
    "09": { title: "循環解放型", organism: "JELLYFISH (Border-Dissolve)", abilities: ["既存システムの初期化", "ヒーリング", "エネルギーの全体還元"], cautions: ["現実座標の消失", "外部要因への過剰透過"], message: "境目がほどけるとき、海は広がる。終わりのあとに、新しい流れが生まれる。" },
    "11": { title: "直感通信型", organism: "MANTA (Dimensional-Glider)", abilities: ["高次信号の受信", "ビジョンの転写", "先導"], cautions: ["過剰な信号負荷", "現実レイヤーとの乖離"], message: "見えない波も、確かに動いている。高く泳ぐほど、海の広さが見えてくる。" },
    "22": { title: "世界設計型", organism: "REEF-ARCHITECT (Global-Struct)", abilities: ["大規模社会設計", "永続的システムの構築", "具現化"], cautions: ["全責任の集中負荷", "微細な不整合への過敏反応"], message: "小さな積み重ねが、やがて海の形になる。時間は、静かに層を作っていく。" },
    "33": { title: "全体統合型", organism: "THE OCEAN (Universal-Field)", abilities: ["全データの包含", "普遍的愛の供給", "存在の肯定"], cautions: ["自己個体意識の希薄化", "肉体的疲労の感知不全"], message: "名前がなくても、海は存在している。すべてを含んだまま、流れは続いていく。" }
};

const introText = `>> CONNECTING_TO_ABYSSAL_SERVER... OK
>> ANALYZING_TEMPORAL_SEED... OK
>> 深海には、もうひとつの「あなた」が泳いでいる。
>> その遺伝子コードを復元し、現在の同期率を算出する。`;

let audioCtx;
function playBeep(freq = 440, duration = 0.1) {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

function initSystem() {
    runIntro();
    createBubbles();
}

async function runIntro() {
    const target = document.getElementById('typed-content');
    const overlay = document.getElementById('intro-overlay');
    const lines = introText.split('\n');
    for (let line of lines) {
        for (let char of line) {
            target.innerHTML += char;
            await new Promise(r => setTimeout(r, 30));
        }
        target.innerHTML += '<br>';
        await new Promise(r => setTimeout(r, 300));
    }
    setTimeout(() => {
        overlay.style.opacity = '0';
        setTimeout(() => overlay.style.display = 'none', 1000);
    }, 1000);
}

function createBubbles() {
    const bg = document.getElementById('ocean-bg');
    for (let i = 0; i < 15; i++) {
        const b = document.createElement('div');
        b.style.position = 'absolute';
        b.style.bottom = '-20px';
        b.style.background = 'rgba(0, 242, 255, 0.2)';
        b.style.borderRadius = '50%';
        const size = Math.random() * 4 + 2 + 'px';
        b.style.width = size; b.style.height = size;
        b.style.left = Math.random() * 100 + 'vw';
        const dur = Math.random() * 10 + 5;
        b.animate([{ transform: 'translateY(0)', opacity: 0.5 }, { transform: `translateY(-110vh)`, opacity: 0 }], { duration: dur * 1000, iterations: Infinity });
        bg.appendChild(b);
    }
}

let depthInterval;
function updateDepth(target) {
    let current = 0;
    const el = document.getElementById('depthVal');
    clearInterval(depthInterval);
    depthInterval = setInterval(() => {
        if(current < target) {
            current += Math.floor(Math.random() * 150) + 50;
            if(current > target) current = target;
            el.innerText = current.toLocaleString();
            playBeep(200 + (current/10), 0.05);
        } else {
            clearInterval(depthInterval);
        }
    }, 100);
}

const resultBtn = document.getElementById('resultBtn');
resultBtn.addEventListener('click', async () => {
    playBeep(880, 0.1);
    let birth = document.getElementById('birthdate').value; 
    if(!birth){alert("INPUT REQUIRED"); return;}
    
    document.getElementById('inputPanel').style.display = 'none';
    document.getElementById('resultContainer').style.display = 'block';
    const loading = document.getElementById('loadingOverlay');
    loading.style.display = 'flex';
    
    // 没入演出：深度更新
    const targetDepth = 4000 + Math.floor(Math.random() * 6000);
    updateDepth(targetDepth);
    
    // プログレスバー
    const bar = document.getElementById('progressBar');
    bar.style.transition = 'none'; bar.style.left = '-100%';
    setTimeout(() => { bar.style.transition = 'left 3s ease-in-out'; bar.style.left = '0%'; }, 50);

    const logs = ["LOCATING_GENOME...", "EXTRACTING_PHANTOM_DNA...", "CALIBRATING_SONAR...", "SYNCING..."];
    const logEl = document.getElementById('analysis-log');
    for(let log of logs) {
        logEl.innerText = log;
        document.body.classList.add('glitch');
        setTimeout(() => document.body.classList.remove('glitch'), 50);
        await new Promise(r => setTimeout(r, 700));
    }

    loading.style.display = 'none';
    showResult(birth, targetDepth);
});

function calcNumerology(dateStr){
    const digits = dateStr.replace(/-/g, '').split('');
    let sum = digits.reduce((acc, d) => acc + Number(d), 0);
    while (sum > 9 && ![11, 22, 33].includes(sum)) {
        sum = sum.toString().split('').reduce((acc, d) => acc + Number(d), 0);
    }
    return sum;
}

function showResult(birth, depth) {
    let num = calcNumerology(birth);
    let code = (num < 10) ? ('0' + num) : num.toString();
    let data = numerologyData[code];
    document.body.classList.add('in-result');
    
    document.getElementById('resultContent').innerHTML = `
        <div class="result-layout">
            <div class="organism-container">
                <img src="code${code}.png" alt="${data.organism}" class="floating-organism anim-float">
            </div>
            <div class="result-content">
                <div style="font-family:'Share Tech Mono'; font-size:0.7rem; color:var(--neon-cyan); margin-bottom:10px;">>> GENOME_SEQUENCE_RECOVERED</div>
                <h2 style="font-size:2.2rem; margin:0 0 20px 0; text-shadow:0 0 20px var(--neon-cyan); border-left:4px solid var(--neon-cyan); padding-left:15px;">${data.title}</h2>
                
                <div class="sensor-grid">
                    <div class="sensor-item">TEMP: 2.4°C</div>
                    <div class="sensor-item">PRESS: ${(depth/10).toFixed(1)}MPa</div>
                    <div class="sensor-item">VITAL: STABLE</div>
                    <div class="sensor-item">SYNC: 99.2%</div>
                </div>

                <p style="margin:20px 0; color:var(--neon-cyan); font-family:'Orbitron'; font-size:1rem; letter-spacing:1px;">${data.organism}</p>
                
                <div style="background:rgba(0,242,255,0.05); border:1px solid var(--border-cyan); padding:20px; font-size:0.9rem; line-height:1.8;">
                    <div style="color:var(--neon-cyan); font-family:'Share Tech Mono'; font-size:0.7rem; margin-bottom:10px;">[RECORDS]</div>
                    ${data.abilities.map(a => `<div style="margin-bottom:5px;">+ ${a}</div>`).join('')}
                    <div style="height:1px; background:var(--border-cyan); margin:15px 0;"></div>
                    <div style="color:#b0dfff; font-style:italic;">"${data.message}"</div>
                </div>
            </div>
        </div>`;
    playBeep(660, 0.2);
}

document.getElementById('backBtn').addEventListener('click', () => {
    playBeep(440, 0.1);
    document.body.classList.remove('in-result');
    window.scrollTo(0,0);
    document.getElementById('resultContainer').style.display = 'none';
    document.getElementById('inputPanel').style.display = 'block';
    document.getElementById('depthVal').innerText = "0";
});

// BGM制御
const musicBtn = document.getElementById('musicBtn');
const bgm = document.getElementById('bgm');
let isPlaying = false;
musicBtn.addEventListener('click', () => {
    if(!isPlaying) {
        bgm.play(); musicBtn.innerText = "AUDIO: ON"; isPlaying = true;
    } else {
        bgm.pause(); musicBtn.innerText = "AUDIO: OFF"; isPlaying = false;
    }
});
</script>
</body>
</html>
